<!DOCTYPE html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Steelyard Â· Beginner Simple</title>
<style>

  @font-face{ font-family:'Tiny5x3'; src:url('TINY5x3-100.otf') format('opentype'); }
  @font-face{ font-family:'Anthony'; src:url('Anthony.otf') format('opentype'); }

  /* 20% */
  html,body{height:100%;margin:0}
  body{
    font-family:Arial, Helvetica, sans-serif;
    background:transparent; position:relative; overflow-x:hidden;
  }
  body::before{
    content:""; position:fixed; inset:0;
    background:url('background.png') center/cover no-repeat;
    opacity:.2; z-index:-1;
  }

  /* up bottom */
  .topbar{position:fixed; top:16px; right:16px; z-index:60;}
  .broider{
    border-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAB4ElEQVR4Aeza4W2DMBCG4bRrdJTO06k6T0fpHK0QKEJHz5KP10CTNxIJ4Nxn5+HkX3m9+UIFBEU5bzdBBYUF4Dg7VFBYAI6zQwWFBeA4O1RQWACOs0MFhQXguEqHwkt4rDhB4ecpqKCwABxnhwoKC8BxdqigsAAch3fo2+fXz/qA17s7br226Xx3YAjAQUP+010KCj9yQa8O+v3x/rI+lvXeP6Z968jjPvFysl7bdL7cxj7sUIxyDhJ0dsDeBcUo56DhoHG/nPatI484//yzx70PBx239GsmCwo/F0EFhQXgODtUUFgAjrNDnwgU/qnHxNmhsLOggsICcJwdKigsAMfZoYLCAnCcHSooLADH2aGCwgJw3KN1KMzTHydov1mzQtAmT/+goP1mzQpBmzz9g4L2mzUrBG3y9A8K2m/WrBgOGv/HFP9rNPo6zt/UAAaHgwJr/FcRgsKPS9Crg8Y9Ma437mmjr+P8f6wvfmXXtR26i29bLOjWZNcdQXfxbYtx0Lgnbqc8987o9eGg53KdP7ug8DMQVFBYAI6zQwWFBeA4O1RQWKAWl1bZoSlNbUDQmltaJWhKUxsQtOaWVgma0tQGBK25pVWCpjS1AUFrbmmVoClNbUDQmltaJWhKUxv4BQAA///xSMxYAAAABklEQVQDAE9EQLg3RXKiAAAAAElFTkSuQmCC") 28 / 28px / 0 round;
    border-width:28px; border-style:solid;
  }
  .btn{ background:transparent; padding:10px 16px; font-weight:bold; cursor:pointer; }

  
  .time-panel{
    position:fixed; top:72px; right:16px; z-index:40;
    display:none; background:transparent; padding:8px;
    width:auto;                 
    box-sizing:border-box;      
    max-height:70vh; overflow-y:auto;
  }
  .time-list{list-style:none; margin:0; padding:0;}
  .time-item{ padding:8px 10px; margin:4px 0; text-align:center; cursor:pointer; }
  .time-item:hover{text-decoration:underline}

  /* central rotation */
  .stage{min-height:100vh; display:grid; place-items:center;}
  .wrap{position:relative; width:560px; max-width:90vw; aspect-ratio:1/1;}
  #steelyard{
    position:absolute; inset:0; width:100%; height:100%; object-fit:contain;
    transform-origin:50% 50%; pointer-events:none;
  }

  /* right 1/4 time */
  .time-readout{
    position:absolute; top:25%; left:100%; transform:translate(18px,-50%);
    font-family:'Tiny5x3', monospace; font-size:80px; white-space:nowrap; user-select:none;
    z-index:100;
  }

  /* random things */
  .spawn-layer{position:fixed; inset:0; z-index:30; pointer-events:none;}
  .item{position:absolute; pointer-events:auto; cursor:grab; user-select:none;}
  .item img{display:block; width:120%; height:120%; object-fit:contain;}

  /* steelyard 80 */
  .dropped{
    position:absolute; width:80px !important; height:80px !important;
    z-index:3; cursor:grab;
  }
  .dropped img{ width:100% !important; height:100% !important; object-fit:contain; }

  /* steelyard frame */
  .tooltip{position:absolute; left:50%; bottom:100%; transform:translate(-50%,-10px); opacity:0; transition:opacity .15s; pointer-events:none;}
  .dropped:hover .tooltip{opacity:1;}
  .tip-frame{
    border-radius:39px;
    background:linear-gradient(145deg,#ffffff,#dedede);
    box-shadow:17px 17px 42px #bebebe, -17px -17px 42px #ffffff;
    padding:6px 10px;
  }
  .tip-text{font-family:'Anthony', cursive; font-size:18px; white-space:nowrap;}
</style>
</head>
<body>


<div class="topbar" id="topbar">
  <button id="btnTime" class="btn broider">Time Selection</button>
</div>


<div id="timePanel" class="time-panel broider">
  <ul id="timeList" class="time-list"></ul>
</div>


<main class="stage">
  <div class="wrap" id="wrap">
    <img id="steelyard" src="steelyard.png" alt="steelyard">
    <div id="timeText" class="time-readout">--:--</div>
  </div>
</main>

<div id="spawnLayer" class="spawn-layer"></div>

<script>

var ITEM_FILES = []; for (var i=1;i<=14;i++){ ITEM_FILES.push(i+'.png'); }
var ITEM_WORDS = ["nature","Hobby","Going out","manual","Attend class","Have a meal","music","Happy","Work","snack","play","dress up","friend","rest"];

var wrap = document.getElementById('wrap');
var steelyard = document.getElementById('steelyard');
var timeText = document.getElementById('timeText');
var spawnLayer = document.getElementById('spawnLayer');
var btnTime = document.getElementById('btnTime');
var timePanel = document.getElementById('timePanel');
var timeList = document.getElementById('timeList');

var uid = 1;
var bag = [];
var selectedBaseMinutes = null;

/* 0=90o */
function shuffle(a){ for(var i=a.length-1;i>0;i--){ var j=Math.floor(Math.random()*(i+1)); var t=a[i]; a[i]=a[j]; a[j]=t; } return a; }
function clamp(v,min,max){ if(v<min) return min; if(v>max) return max; return v; }
function hhmm(m){ var h=Math.floor(m/60), n=m%60; return (h<10?'0'+h:h)+':'+(n<10?'0'+n:n); }
function bjMinutesNow(){ var now=new Date(); var u=now.getUTCHours()*60+now.getUTCMinutes(); return (u+8*60)%1440; }
function minutesToAngle(mins){ return -90 + (mins/1440)*180; }


function buildTimeList(){
  timeList.innerHTML='';
  for(var m=30;m<1440;m+=30){
    var li=document.createElement('li');
    li.className='time-item'; li.textContent=hhmm(m);
    li.onclick=(function(v){ return function(e){ e.stopPropagation(); selectedBaseMinutes=v; refresh(); }; })(m%1440);
    timeList.appendChild(li);
  }
  var last=document.createElement('li'); last.className='time-item'; last.textContent='00:00';
  last.onclick=function(e){ e.stopPropagation(); selectedBaseMinutes=0; refresh(); };
  timeList.appendChild(last);
}

/* time revolve */
function droppedCount(){ return wrap.querySelectorAll('.dropped[data-on="1"]').length; }
function refresh(){
  var base=(selectedBaseMinutes===null)?bjMinutesNow():selectedBaseMinutes;
  var plus=droppedCount()*30;
  var mins=(base+plus)%1440;
  timeText.textContent=hhmm(mins);
  steelyard.style.transform='rotate('+minutesToAngle(mins)+'deg)';
}

function refillBag(){ bag=shuffle([0,1,2,3,4,5,6,7,8,9,10,11,12,13]); }
function spawnOne(){
  if(bag.length===0) refillBag();
  for(const _ of [0]){ 
    var idx=bag.pop();
    var box=document.createElement('div'); box.className='item'; box.id='itm-'+(uid++); box.dataset.idx=''+idx;

    var base=56+Math.random()*120; 
    var rot=Math.random()*50-25;
    box.style.width=base+'px';
    box.style.height=base+'px';
    box.style.transform='rotate('+rot+'deg)';

    var vw=Math.max(document.documentElement.clientWidth,320);
    var vh=Math.max(document.documentElement.clientHeight,240);
    var left=Math.random()*(vw-base), top=Math.random()*(vh-base);
    if(left>vw-220 && top<180){ left-=220; top+=160; }
    box.style.left=left+'px'; box.style.top=top+'px';

    var img=document.createElement('img'); img.src=ITEM_FILES[idx]; img.alt=ITEM_WORDS[idx]; img.draggable=false;
    box.appendChild(img);


    box.draggable=true;
    box.ondragstart=function(e){
      var r=box.getBoundingClientRect();
      var dx=e.clientX-r.left, dy=e.clientY-r.top;
      e.dataTransfer.setData('text/plain', JSON.stringify({ id:box.id, idx:idx, dx:dx, dy:dy }));
      e.dataTransfer.effectAllowed='move';
    };

    spawnLayer.appendChild(box);
  }
}


function pointerInSteelyard(x,y){
  var r=steelyard.getBoundingClientRect();
  return x>=r.left && x<=r.right && y>=r.top && y<=r.bottom;
}

function attachToSteelyard(info, clientX, clientY){
  var el=document.getElementById(info.id);
  if(!el) return;

  var rWrap=wrap.getBoundingClientRect();
  var x=clientX - rWrap.left - info.dx;
  var y=clientY - rWrap.top  - info.dy;

  var already=el.classList.contains('dropped');
  if(!already){

    el.style.width='80px';
    el.style.height='80px';
    el.style.transform='none';

    el.classList.remove('item');
    el.classList.add('dropped');
    el.setAttribute('data-on','1');

  
    el.draggable=true;
    el.ondragstart=function(e){
      var r=el.getBoundingClientRect();
      var dx=e.clientX-r.left, dy=e.clientY-r.top;
      e.dataTransfer.setData('text/plain', JSON.stringify({ id:el.id, idx:Number(el.dataset.idx||0), dx:dx, dy:dy }));
      e.dataTransfer.effectAllowed='move';
    };

    /* steelyard frame */
    if(!el.querySelector('.tooltip')){
      var tip=document.createElement('div'); tip.className='tooltip';
      var frame=document.createElement('div'); frame.className='tip-frame';
      var txt=document.createElement('div'); txt.className='tip-text';
      txt.textContent=ITEM_WORDS[Number(el.dataset.idx||0)];
      frame.appendChild(txt); tip.appendChild(frame); el.appendChild(tip);
    }

    wrap.appendChild(el);
  }


  var maxX=wrap.clientWidth-el.offsetWidth;
  var maxY=wrap.clientHeight-el.offsetHeight;
  el.style.left=clamp(x,0,Math.max(0,maxX))+'px';
  el.style.top =clamp(y,0,Math.max(0,maxY))+'px';

  refresh();
}


function initEvents(){
 
  btnTime.onclick=function(e){
    e.stopPropagation();
 
    if(timePanel.style.display==='block'){
      timePanel.style.display='none';
    }else{
      var w = btnTime.offsetWidth;      
      timePanel.style.width = w + 'px';
      timePanel.style.display='block';
    }
  };

  document.addEventListener('click', function(e){
    if(e.target.closest('#topbar') || e.target.closest('#timePanel')) return;
    timePanel.style.display='none'; 
    spawnOne();                   
  });

  wrap.addEventListener('dragover', function(e){
    if(!pointerInSteelyard(e.clientX, e.clientY)) return;
    e.preventDefault();
  });
  wrap.addEventListener('drop', function(e){
    if(!pointerInSteelyard(e.clientX, e.clientY)) return;
    e.preventDefault();
    try{
      var info=JSON.parse(e.dataTransfer.getData('text/plain')||'{}');
      attachToSteelyard(info, e.clientX, e.clientY);
    }catch(err){}
  });


  window.addEventListener('resize', function(){
    if(timePanel.style.display==='block'){
      timePanel.style.width = btnTime.offsetWidth + 'px';
    }
  });
}


function init(){
  buildTimeList();
  refillBag();
  refresh();
  setInterval(function(){ if(selectedBaseMinutes===null) refresh(); }, 20000);
  initEvents();
}
init();
</script>
</body>
</html>
